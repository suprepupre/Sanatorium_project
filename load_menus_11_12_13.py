from datetime import date
from dining.models import Dish, MenuCycle, DailyMenu, MenuItem

# Даты, на которые создаём меню
DATES = [
    date(2025, 12, 11),
    date(2025, 12, 12),
    date(2025, 12, 13),
]


def get_or_create_dish(name: str):
    dish, _ = Dish.objects.get_or_create(
        name=name,
        defaults={
            "is_diet": True,
            "output": 200,  # условный выход, потом можно поправить в справочнике
        },
    )
    return dish


def add_meal(daily_menu_obj, meal_time: str, groups):
    """
    meal_time: 'breakfast' | 'lunch' | 'snack' | 'dinner'
    groups: список (категория, [названия блюд])
    """
    order = 1
    for category, names in groups:
        for name in names:
            dish = get_or_create_dish(name)
            MenuItem.objects.create(
                daily_menu=daily_menu_obj,
                meal_time=meal_time,
                category=category,
                dish=dish,
                order_index=order,
            )
            order += 1


# ---------- ЗАВТРАК ----------

breakfast_groups = [
    ("НАПИТКИ", [
        "Нектар фруктовый",
        "Сок томатный",
        "Молоко",
    ]),
    ("ЗАКУСКИ", [
        "Творог со сметаной и сахаром",
        "Йогурт",
        "Салат из квашеной капусты и помидоров со сметаной",
        "Каша молочная рисовая",
        "Сыр",
    ]),
    ("2-е БЛЮДА", [
        "Капуста белокочанная запечённая с сыром под соусом (мука, молоко)",
        "Рыба отварная (горбуша), каша ячневая",
        "Колбаса по-домашнему, картофельное пюре",
        "Колбаса по-домашнему, каша ячневая вязкая",
        "Биточки паровые (говядина, батон, без яйца, мука), картофельно-гороховое пюре",
        "Биточки паровые (говядина, батон, без яйца), каша ячневая вязкая",
        "Хлеб",
        "Батон",
        "Какао",
        "Сахар",
        "Масло",
    ]),
]

# ---------- ОБЕД ----------

lunch_groups = [
    ("ЗАКУСКИ", [
        "Салат из белокочанной капусты и огурца с растительным маслом",
        "Салат из моркови с изюмом со сметаной",
        "Салат «Лепельская загадка» (курица, морковь, огурец, лук, майонез)",
    ]),
    ("1-е БЛЮДА", [
        "Щи из капусты с картофелем со сметаной",
        "Суп картофельный с рисом",
        "Затирка с молоком (мука, яйцо)",
    ]),
    ("2-е БЛЮДА", [
        "Голубцы овощные с рисом в соусе",
        "Блинчики с повидлом со сметаной",
        "Говядина отварная под белым соусом, каша гречневая вязкая",
        "Говядина отварная под белым соусом, макароны отварные",
        "Рагу из свинины (картофель, морковь, лук)",
        "Фрикадельки паровые (говядина), каша гречневая вязкая",
        "Фрикадельки паровые (говядина), макароны отварные с соусом",
        "Компот",
        "Хлеб",
    ]),
]

# ---------- ПОЛДНИК ----------

snack_groups = [
    ("ПОЛДНИК", [
        "Фрукты",
    ]),
]

# ---------- УЖИН ----------

dinner_groups = [
    ("ЗАКУСКИ", [
        "Салат из свёклы с сыром со сметаной",
        "Салат из помидоров и перца с растительным маслом",
        "Салат «Лёгкий» (капуста, крабовые палочки, огурец, яйцо, зелёный горошек, майонез)",
    ]),
    ("2-е БЛЮДА", [
        "Оладьи картофельные (тёртый картофель, яйцо, лук) со сметаной",
        "Рулет паровой (говядина, батон, молоко, яйцо), картофельное пюре",
        "Рыба тушёная в сметане с луком (скумбрия, мука), картофельная каша вязкая",
        "Рыба тушёная в сметане с луком (скумбрия, мука), картофельное пюре",
        "Рулет из свинины, фарш, чернослив, соус",
        "Рулет из свинины, фарш, чернослив, овсяная каша",
    ]),
    ("НАПИТКИ", [
        "Чай чёрный",
        "Чай зелёный",
        "Хлеб",
        "Батон",
        "Кондитерские изделия",
    ]),
]


# ---------- создаём меню на каждую дату ----------

for target_date in DATES:
    day_index = target_date.weekday() + 1  # 1-пн ... 7-вс
    print("Создаём меню на дату:", target_date, "день цикла:", day_index)

    cycle, _ = MenuCycle.objects.get_or_create(
        name="Меню №1",
        defaults={"days_count": 7},
    )

    daily_menu, created = DailyMenu.objects.get_or_create(
        cycle=cycle,
        day_index=day_index,
        diet_kind="regular",
    )

    # чистим старые позиции
    daily_menu.items.all().delete()

    add_meal(daily_menu, "breakfast", breakfast_groups)
    add_meal(daily_menu, "lunch", lunch_groups)
    add_meal(daily_menu, "snack", snack_groups)
    add_meal(daily_menu, "dinner", dinner_groups)

    print("Готово:", daily_menu)